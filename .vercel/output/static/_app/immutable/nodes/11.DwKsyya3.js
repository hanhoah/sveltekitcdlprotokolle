import{s as Q}from"../chunks/supabaseClient.DvHc7uqV.js";import{s as te,e as v,t as C,a as A,m as L,c as P,b as I,d as E,f as d,g as N,l as k,i as y,h as b,j,Q as oe,o as X,n as w,H as re,q as ae}from"../chunks/scheduler.DBuKuVba.js";import{h as O,u as ne}from"../chunks/await_block.CtqnqUU4.js";import{e as H}from"../chunks/each.D6YF6ztN.js";import{S as le,i as se,t as D,a as z,g as ie,c as ce,b as Y,d as Z,m as x,e as ee}from"../chunks/index.CsvtYcO8.js";import{p as ue}from"../chunks/stores.DkB-N-CC.js";import{g as T,P as fe}from"../chunks/shops.XWkl3EzL.js";import{S as de}from"../chunks/Spinner.BpP10mi9.js";async function ge(a){console.log("getCategoryDescription");const{data:t,error:n}=await Q.from("categories").select("description").eq("id",a).single();try{return t&&t.description?t.description:null}catch{return null}}async function pe(a){console.log("getProductsByCategoryId");const{data:t,error:n}=await Q.from("productswithcategory").select("*").eq("category_id",a).order("name");if(n)console.log("Fehler beim Abrufen von Produkten getProductsByCategoryId lib/functions/products.ts");else return t}async function me(a,t,n){console.log("getProductsByCategoryIdWithPagination"),console.log("page ist ",t);const o=(t-1)*n,{data:e,error:l}=await Q.from("productswithcategory").select("*").eq("category_id",a).order("name").range(o,o+n-1);return l?(console.error("Error fetching products:",l.message),null):e}function he(){return console.log("getCategories"),[{id:5,name:"Ayurveda"},{id:6,name:"Aphrodisiaka"}]}async function _e(a){console.log("countProductsByCategory");const{count:t}=await Q.from("products_categories").select("*",{count:"exact",head:!0}).eq("category_id",a);return t}async function ye(a){console.log("getCategoryNameById");const{data:t}=await Q.from("categories").select("name").eq("id",a);return t[0].name}const be=!1;async function ke(a,t,n){return console.log("fetchProducts"),t?me(a,n,50):pe(a)}async function ve({params:a,url:t}){const n=t.searchParams.get("page")||1,o=a.catid,e=await _e(parseInt(o)),l=await ye(parseInt(o)),r=he(),s=await ge(parseInt(o)),i=`${l} - CDL Protokolle`,c=s||`Entdecken Sie eine Vielzahl von Produkten in der Kategorie ${l} auf CDL Protokolle.`,g=e>50,p=await ke(parseInt(o),g,n);return{data:{catid:o,catname:l,productcategories:r,productQty:e,description:s,title:i,metaDescription:c,page:n},streamed:{products:p}}}const Ve=Object.freeze(Object.defineProperty({__proto__:null,load:ve,prerender:be},Symbol.toStringTag,{value:"Module"}));function Pe(){const a={root:null,rootMargin:"0px",threshold:.1},t=(o,e)=>{o.forEach(l=>{if(l.isIntersecting){const r=l.target.querySelector("img");r&&(r.loading="lazy"),e.unobserve(l.target)}})},n=new IntersectionObserver(t,a);document.querySelectorAll(".lazy-load").forEach(o=>{n.observe(o)})}function W(a,t,n){const o=a.slice();return o[6]=t[n],o}function F(a,t,n){const o=a.slice();return o[10]=t[n],o}function U(a){let t,n;return{c(){t=v("div"),n=C(a[3]),this.h()},l(o){t=P(o,"DIV",{id:!0});var e=I(t);n=E(e,a[3]),e.forEach(d),this.h()},h(){k(t,"id","description")},m(o,e){y(o,t,e),b(t,n)},p(o,e){e&8&&j(n,o[3])},d(o){o&&d(t)}}}function Ie(a){return{c:w,l:w,m:w,p:w,i:w,o:w,d:w}}function we(a){let t,n,o=H(a[9]),e=[];for(let r=0;r<o.length;r+=1)e[r]=G(F(a,o,r));const l=r=>z(e[r],1,1,()=>{e[r]=null});return{c(){for(let r=0;r<e.length;r+=1)e[r].c();t=L()},l(r){for(let s=0;s<e.length;s+=1)e[s].l(r);t=L()},m(r,s){for(let i=0;i<e.length;i+=1)e[i]&&e[i].m(r,s);y(r,t,s),n=!0},p(r,s){if(s&1){o=H(r[9]);let i;for(i=0;i<o.length;i+=1){const c=F(r,o,i);e[i]?(e[i].p(c,s),D(e[i],1)):(e[i]=G(c),e[i].c(),D(e[i],1),e[i].m(t.parentNode,t))}for(ie(),i=o.length;i<e.length;i+=1)l(i);ce()}},i(r){if(!n){for(let s=0;s<o.length;s+=1)D(e[s]);n=!0}},o(r){e=e.filter(Boolean);for(let s=0;s<e.length;s+=1)z(e[s]);n=!1},d(r){r&&d(t),X(e,r)}}}function G(a){let t,n,o,e=T(a[10].id)+"",l,r,s,i;return r=new fe({props:{product:{id:a[10].id,name:a[10].name,img:a[10].image}}}),{c(){t=v("div"),n=v("li"),o=new re(!1),l=A(),Y(r.$$.fragment),s=A(),this.h()},l(c){t=P(c,"DIV",{class:!0});var g=I(t);n=P(g,"LI",{class:!0});var p=I(n);o=ae(p,!1),l=N(p),Z(r.$$.fragment,p),p.forEach(d),s=N(g),g.forEach(d),this.h()},h(){o.a=l,k(n,"class","my-2 relative"),k(t,"class","lazy-load")},m(c,g){y(c,t,g),b(t,n),o.m(e,n),b(n,l),x(r,n,null),b(t,s),i=!0},p(c,g){(!i||g&1)&&e!==(e=T(c[10].id)+"")&&o.p(e);const p={};g&1&&(p.product={id:c[10].id,name:c[10].name,img:c[10].image}),r.$set(p)},i(c){i||(D(r.$$.fragment,c),i=!0)},o(c){z(r.$$.fragment,c),i=!1},d(c){c&&d(t),ee(r)}}}function Ce(a){let t,n,o;return t=new de({}),{c(){Y(t.$$.fragment),n=C(`
          Lade Produkte ...`)},l(e){Z(t.$$.fragment,e),n=E(e,`
          Lade Produkte ...`)},m(e,l){x(t,e,l),y(e,n,l),o=!0},p:w,i(e){o||(D(t.$$.fragment,e),o=!0)},o(e){z(t.$$.fragment,e),o=!1},d(e){e&&d(n),ee(t,e)}}}function J(a){let t,n=H(a[5](a[2])),o=[];for(let e=0;e<n.length;e+=1)o[e]=R(W(a,n,e));return{c(){t=v("div");for(let e=0;e<o.length;e+=1)o[e].c();this.h()},l(e){t=P(e,"DIV",{class:!0});var l=I(t);for(let r=0;r<o.length;r+=1)o[r].l(l);l.forEach(d),this.h()},h(){k(t,"class","page-selector svelte-18pvoj2")},m(e,l){y(e,t,l);for(let r=0;r<o.length;r+=1)o[r]&&o[r].m(t,null)},p(e,l){if(l&54){n=H(e[5](e[2]));let r;for(r=0;r<n.length;r+=1){const s=W(e,n,r);o[r]?o[r].p(s,l):(o[r]=R(s),o[r].c(),o[r].m(t,null))}for(;r<o.length;r+=1)o[r].d(1);o.length=n.length}},d(e){e&&d(t),X(o,e)}}}function Ee(a){let t,n=a[6]+"",o,e;return{c(){t=v("a"),o=C(n),this.h()},l(l){t=P(l,"A",{href:!0,class:!0});var r=I(t);o=E(r,n),r.forEach(d),this.h()},h(){k(t,"href",e="/produkte/cat/"+a[4]+"?page="+a[6]),k(t,"class","page-number svelte-18pvoj2")},m(l,r){y(l,t,r),b(t,o)},p(l,r){r&4&&n!==(n=l[6]+"")&&j(o,n),r&20&&e!==(e="/produkte/cat/"+l[4]+"?page="+l[6])&&k(t,"href",e)},d(l){l&&d(t)}}}function Be(a){let t,n=a[6]+"",o;return{c(){t=v("span"),o=C(n),this.h()},l(e){t=P(e,"SPAN",{class:!0});var l=I(t);o=E(l,n),l.forEach(d),this.h()},h(){k(t,"class","page-number current-page svelte-18pvoj2")},m(e,l){y(e,t,l),b(t,o)},p(e,l){l&4&&n!==(n=e[6]+"")&&j(o,n)},d(e){e&&d(t)}}}function R(a){let t;function n(l,r){return l[6]==l[1]?Be:Ee}let o=n(a),e=o(a);return{c(){e.c(),t=L()},l(l){e.l(l),t=L()},m(l,r){e.m(l,r),y(l,t,r)},p(l,r){o===(o=n(l))&&e?e.p(l,r):(e.d(1),e=o(l),e&&(e.c(),e.m(t.parentNode,t)))},d(l){l&&d(t),e.d(l)}}}function $e(a){let t,n,o=a[0].data.productQty+"",e,l,r=a[0].data.catname+"",s,i,c,g,p,B,V,M=a[5](a[2]),S,q,m=a[3]&&U(a),_={ctx:a,current:null,token:null,hasCatch:!1,pending:Ce,then:we,catch:Ie,value:9,blocks:[,,,]};O(B=a[0].streamed.products,_);let h=M&&J(a);return{c(){t=v("div"),n=v("h2"),e=C(o),l=C(" Produkte der Kategorie  "),s=C(r),i=C(" gefunden"),c=A(),m&&m.c(),g=A(),p=v("ul"),_.block.c(),V=A(),h&&h.c(),S=L(),this.h()},l(u){t=P(u,"DIV",{class:!0});var f=I(t);n=P(f,"H2",{});var $=I(n);e=E($,o),l=E($," Produkte der Kategorie  "),s=E($,r),i=E($," gefunden"),$.forEach(d),f.forEach(d),c=N(u),m&&m.l(u),g=N(u),p=P(u,"UL",{class:!0});var K=I(p);_.block.l(K),K.forEach(d),V=N(u),h&&h.l(u),S=L(),this.h()},h(){k(t,"class","px-2 m-2 border-2 "),k(p,"class","grid grid-cols-2 md:grid-cols-3")},m(u,f){y(u,t,f),b(t,n),b(n,e),b(n,l),b(n,s),b(n,i),y(u,c,f),m&&m.m(u,f),y(u,g,f),y(u,p,f),_.block.m(p,_.anchor=null),_.mount=()=>p,_.anchor=null,y(u,V,f),h&&h.m(u,f),y(u,S,f),q=!0},p(u,[f]){a=u,(!q||f&1)&&o!==(o=a[0].data.productQty+"")&&j(e,o),(!q||f&1)&&r!==(r=a[0].data.catname+"")&&j(s,r),a[3]?m?m.p(a,f):(m=U(a),m.c(),m.m(g.parentNode,g)):m&&(m.d(1),m=null),_.ctx=a,f&1&&B!==(B=a[0].streamed.products)&&O(B,_)||ne(_,a,f),f&4&&(M=a[5](a[2])),M?h?h.p(a,f):(h=J(a),h.c(),h.m(S.parentNode,S)):h&&(h.d(1),h=null)},i(u){q||(D(_.block),q=!0)},o(u){for(let f=0;f<3;f+=1){const $=_.blocks[f];z($)}q=!1},d(u){u&&(d(t),d(c),d(g),d(p),d(V),d(S)),m&&m.d(u),_.block.d(),_.token=null,_=null,h&&h.d(u)}}}function Se(a,t,n){let o,e,l,r;console.log(ue);let{data:s}=t;oe(()=>{Pe()});function i(c){if(c>50){let g=Math.ceil(c/50);return Array.from({length:g},(p,B)=>B+1)}else return null}return a.$$set=c=>{"data"in c&&n(0,s=c.data)},a.$$.update=()=>{a.$$.dirty&1&&n(4,o=s.data.catid),a.$$.dirty&1&&n(3,e=s.data.description),a.$$.dirty&1&&n(2,l=s.data.productQty),a.$$.dirty&1&&n(1,r=s.data.page)},[s,r,l,e,o,i]}class He extends le{constructor(t){super(),se(this,t,Se,$e,te,{data:0})}}export{He as component,Ve as universal};
